var __awaiter=this&&this.__awaiter||function(t,e,s,n){return new(s||(s=Promise))(function(o,a){function i(t){try{c(n.next(t))}catch(t){a(t)}}function r(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s(function(t){t(e)})).then(i,r)}c((n=n.apply(t,e||[])).next())})};class MessagePopup{constructor(t,e,s){this._autoDestroy=(()=>{this._autoDestroyTimeout=window.setTimeout(this.destroy.bind(this),2e4)}),this._document=t,this._uiOptions=s,this._controls={},this._eventListeners=[],this._render().then(()=>{s.destroysAutomatically&&this._autoDestroy()})}_render(){var t;return __awaiter(this,void 0,void 0,function*(){if(this._controls.container)return;this._controls.container=createContainerElement(this._document,MessagePopup.CONTAINER_ELEMENT_NAME),this._controls.container.classList.add("lt-message-container","lt-message-container--"+this._uiOptions.className),null===(t=document.firstElementChild)||void 0===t||t.appendChild(this._controls.container);const e=t=>{t.stopImmediatePropagation()};this._eventListeners.push(addUseCaptureEvent(this._controls.container,"mousedown",t=>{t.target instanceof HTMLElement&&t.target.closest("[data-lt-prevent-focus]")&&t.preventDefault(),e(t)}),addUseCaptureEvent(this._controls.container,"mouseup",e),addUseCaptureEvent(this._controls.container,"pointerdown",e),addUseCaptureEvent(this._controls.container,"pointerup",e),addUseCaptureEvent(this._controls.container,"focusin",e),addUseCaptureEvent(this._controls.container,"focusout",e)),this._controls.container.addEventListener("click",e);const s=this._document.createElement("lt-div");if(s.classList.add("lt-message-container__illustration"),BrowserDetector.isSafari()&&s.classList.add("lt-message-container__illustration--safari"),this._controls.container.appendChild(s),this._uiOptions.isClosable&&(this._controls.closeButton=this._document.createElement("lt-div"),this._controls.closeButton.className="lt-message-container__close",this._controls.closeButton.setAttribute("data-lt-prevent-focus",""),this._controls.container.appendChild(this._controls.closeButton),this._eventListeners.push(addUseCaptureEvent(this._controls.closeButton,"click",this._onCloseButtonClicked.bind(this)))),this._uiOptions.destroysAutomatically){const t=this._document.createElement("lt-div");t.className="lt-message-container__progressbar",this._controls.container.appendChild(t)}const n=this._document.createElement("lt-div");n.className="lt-message-container__text-wrapper",this._controls.container.appendChild(n);const o=this._document.createElement("lt-span");o.className="lt-message-container__text-wrapper__headline",o.textContent=MessagePopup.MESSAGES.DISABLED_MESSAGE_HEADLINE,n.appendChild(o);const a=this._document.createElement("lt-span");if(a.className="lt-message-container__text-wrapper__text",a.textContent=MessagePopup.MESSAGES.DISABLED_MESSAGE_TEXT,n.appendChild(a),this._uiOptions.hasPrimaryButton||this._uiOptions.hasSecondaryButton){const t=this._document.createElement("lt-div");t.className="lt-message-container__button-wrapper",this._controls.container.appendChild(t),this._uiOptions.hasPrimaryButton&&(this._controls.primaryButton=this._document.createElement("lt-div"),this._controls.primaryButton.className="lt-message-container__button-wrapper__primary",this._controls.primaryButton.setAttribute("data-lt-prevent-focus",""),this._controls.primaryButton.textContent=MessagePopup.MESSAGES.DISABLED_MESSAGE_PRIMARY_BUTTON,t.appendChild(this._controls.primaryButton),this._eventListeners.push(addUseCaptureEvent(this._controls.primaryButton,"click",this._onPrimaryButtonClicked.bind(this)))),this._uiOptions.hasSecondaryButton&&(this._controls.secondaryButton=this._document.createElement("lt-div"),this._controls.secondaryButton.className="lt-message-container__button-wrapper__secondary",this._controls.secondaryButton.setAttribute("data-lt-prevent-focus",""),this._controls.secondaryButton.textContent=MessagePopup.MESSAGES.DISABLED_MESSAGE_SECONDARY_BUTTON,t.appendChild(this._controls.secondaryButton),this._eventListeners.push(addUseCaptureEvent(this._controls.secondaryButton,"click",this._onSecondaryButtonClicked.bind(this))))}})}_onPrimaryButtonClicked(t){t.stopImmediatePropagation(),StorageController.create().onReady(t=>{t.updateUIState({hasSeenTurnOnMessagePopup:!0}),t.destroy()}),this.destroy()}_onSecondaryButtonClicked(t){t.stopImmediatePropagation();const e={message:this};dispatchCustomEvent(document,MessagePopup.eventNames.turnOn,e),this.destroy()}_onCloseButtonClicked(t){t.stopImmediatePropagation(),StorageController.create().onReady(t=>{t.updateUIState({hasSeenTurnOnMessagePopup:!0}),t.destroy()}),this.destroy()}_onUnload(){this.destroy()}destroy(){fadeOutAndRemove(this._controls.container),this._controls={},window.removeEventListener("pagehide",this._onUnload,!0),this._eventListeners.forEach(t=>{t.destroy()}),this._eventListeners=[];const t={message:this};window.clearTimeout(this._autoDestroyTimeout),dispatchCustomEvent(document,MessagePopup.eventNames.destroyed,t)}}MessagePopup.CONTAINER_ELEMENT_NAME="lt-message",MessagePopup.MESSAGES={DISABLED_MESSAGE_HEADLINE:i18nManager.getMessage("messagePopupTurnOnheadline"),DISABLED_MESSAGE_TEXT:i18nManager.getMessage("messagePopupTurnOntext"),DISABLED_MESSAGE_PRIMARY_BUTTON:i18nManager.getMessage("messagePopupTurnOnPrimaryButton"),DISABLED_MESSAGE_SECONDARY_BUTTON:i18nManager.getMessage("messagePopupTurnOnSecondaryButton")},MessagePopup.eventNames={destroyed:"lt-message.destroyed",turnOn:"lt-message.turn-on"};